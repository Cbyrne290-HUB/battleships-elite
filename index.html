<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Battleship War: Tactical Command</title>
    <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
    <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>
    <style>
        :root { --neon: #22c55e; --bg: #020617; }
        body { background: var(--bg); color: var(--neon); font-family: 'Courier New', monospace; text-align: center; margin: 0; }
        .hud { width: 1000px; margin: 20px auto; padding: 20px; border: 2px solid #1e293b; background: #0f172a; position: relative; }
        
        .main-layout { display: flex; justify-content: center; gap: 30px; margin-top: 20px; }
        
        /* Hangar */
        .hangar { width: 200px; display: flex; flex-direction: column; gap: 10px; border: 1px dashed #334155; padding: 10px; }
        .drag-ship { background: rgba(34, 197, 94, 0.1); border: 1px solid var(--neon); cursor: grab; padding: 5px; font-size: 10px; }

        /* Grids */
        .grid { display: grid; grid-template-columns: 30px repeat(12, 32px); gap: 1px; background: var(--neon); border: 1px solid var(--neon); }
        .cell { width: 32px; height: 32px; background: var(--bg); position: relative; }
        .label { background: #0f172a; color: var(--neon); display: flex; align-items: center; justify-content: center; font-size: 10px; }

        /* Statuses */
        .placed { background: #475569 !important; border: 1px solid #94a3b8; }
        .hit { background: #ef4444 !important; color: white; display: flex; align-items: center; justify-content: center; }
        .miss { background: #38bdf8 !important; opacity: 0.3; }
        
        /* Win Overlay */
        #win-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        .win-box { border: 4px solid var(--neon); padding: 50px; box-shadow: 0 0 50px var(--neon); }

        .controls { margin-top: 20px; display: flex; gap: 10px; justify-content: center; }
        button { background: var(--neon); color: black; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div id="win-overlay">
    <div class="win-box">
        <h1 style="font-size: 60px;">YOU WIN</h1>
        <p>MISSION ACCOMPLISHED. ENEMY SUNK.</p>
        <button onclick="location.reload()">REDEPLOY</button>
    </div>
</div>

<div class="hud">
    <h1>STRATEGY PANEL</h1>
    <div id="status">DRAG SHIPS TO GRID. PRESS 'R' TO ROTATE.</div>

    <div class="main-layout">
        <div class="hangar">
            <div class="drag-ship" draggable="true" id="s0">CARRIER (4x2)</div>
            <div class="drag-ship" draggable="true" id="s1">DREADNOUGHT (6x1)</div>
            <div class="drag-ship" draggable="true" id="s2">SUBMARINE (3x1)</div>
            <div class="drag-ship" draggable="true" id="s3">FRIGATE (5x1)</div>
        </div>

        <div>
            <div id="p-grid" class="grid"></div>
            <p>TACTICAL GRID</p>
        </div>

        <div id="enemy-area" style="display:none;">
            <div id="e-grid" class="grid"></div>
            <p>ENEMY RADAR</p>
        </div>
    </div>

    <div class="controls">
        <button id="start-btn" style="display:none;">START BATTLE</button>
    </div>
</div>

<script type="py">
from pyscript import document, window
import random

# Config
SHIP_SPECS = [
    {"id": 0, "size": (4, 2)}, {"id": 1, "size": (6, 1)},
    {"id": 2, "size": (3, 1)}, {"id": 3, "size": (5, 1)}
]
SIZE = 12
player_fleet = []
enemy_fleet = []
is_horiz = True

def init():
    for g_id in ["p-grid", "e-grid"]:
        g = document.getElementById(g_id)
        g.appendChild(create_cell("", "label"))
        for i in range(1, SIZE+1): g.appendChild(create_cell(str(i), "label"))
        for r in range(SIZE):
            g.appendChild(create_cell(chr(65+r), "label"))
            for c in range(SIZE):
                cell = create_cell("", "cell")
                cell.id = f"{g_id[0]}-{r}-{c}"
                if g_id == "p-grid":
                    cell.ondragover = lambda e: e.preventDefault()
                    cell.ondrop = lambda e, row=r, col=c: handle_drop(e, row, col)
                else:
                    cell.onclick = lambda e, row=r, col=c: attack(row, col)
                g.appendChild(cell)
    setup_enemy()

def create_cell(t, cls):
    c = document.createElement("div")
    c.className = f"cell {cls}"
    c.innerText = t
    return c

def handle_drop(event, r, c):
    s_id = int(event.dataTransfer.getData("text"))
    spec = SHIP_SPECS[s_id]
    w, h = spec["size"] if is_horiz else (spec["size"][1], spec["size"][0])
    
    if r+h <= SIZE and c+w <= SIZE:
        coords = set((r+i, c+j) for i in range(h) for j in range(w))
        if any(coords & s["coords"] for s in player_fleet): return
        
        for row, col in coords:
            document.getElementById(f"p-{row}-{col}").classList.add("placed")
        
        player_fleet.append({"coords": coords, "hp": len(coords)})
        document.getElementById(f"s{s_id}").style.display = "none"
        
        if len(player_fleet) == len(SHIP_SPECS):
            document.getElementById("start-btn").style.display = "block"

def setup_enemy():
    for spec in SHIP_SPECS:
        placed = False
        while not placed:
            r, c, rot = random.randint(0,11), random.randint(0,11), random.choice([True, False])
            w, h = spec["size"] if rot else (spec["size"][1], spec["size"][0])
            if r+h <= SIZE and c+w <= SIZE:
                coords = set((r+i, c+j) for i in range(h) for j in range(w))
                if not any(coords & s["coords"] for s in enemy_fleet):
                    enemy_fleet.append({"coords": coords, "hp": len(coords)})
                    placed = True

def attack(r, c):
    cell = document.getElementById(f"e-{r}-{c}")
    if "hit" in cell.className or "miss" in cell.className: return
    hit = False
    for s in enemy_fleet:
        if (r, c) in s["coords"]:
            cell.classList.add("hit"); cell.innerText = "X"; s["hp"] -= 1; hit = True
            if all(ship["hp"] == 0 for ship in enemy_fleet):
                document.getElementById("win-overlay").style.display = "flex"
            break
    if not hit: cell.classList.add("miss")

def on_drag_start(event):
    event.dataTransfer.setData("text", event.target.id[1:])

def rotate(event):
    if event.key.lower() == 'r':
        global is_horiz
        is_horiz = not is_horiz
        document.getElementById("status").innerText = f"ROTATION: {'HORIZ' if is_horiz else 'VERT'}"

def start_battle(e):
    document.getElementById("enemy-area").style.display = "block"
    document.getElementById("status").innerText = "ATTACK ENEMY RADAR"

init()
window.on_drag_start = on_drag_start
for i in range(4): document.getElementById(f"s{i}").ondragstart = on_drag_start
window.addEventListener("keydown", rotate)
document.getElementById("start-btn").onclick = start_battle
</script>
</body>
</html>
