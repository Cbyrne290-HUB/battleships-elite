<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battleship Master AI</title>
    <style>
        :root { 
            --bg: #0f172a; --panel: #1e293b; --player: #3b82f6; 
            --enemy: #ef4444; --accent: #10b981; --border: #475569;
        }
        body { background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; margin: 0; min-height: 100vh; overflow-x: hidden; }
        
        /* Big Bold Centered Title */
        .main-title { 
            font-size: 5rem; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 12px; 
            margin: 20px 0 10px 0; 
            text-align: center; 
            color: #fff;
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.5), 4px 4px 0px var(--panel);
            width: 100%;
        }

        .top-bar { width: 100%; display: flex; justify-content: space-between; padding: 0 30px 15px 30px; box-sizing: border-box; align-items: center; }
        .help-btn, .audio-ctrl { background: #334155; border: none; color: white; padding: 10px 20px; cursor: pointer; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .help-btn { background: var(--player); }
        .help-btn:hover { background: #2563eb; }

        .stats-bar { font-size: 1.4rem; font-weight: bold; color: var(--accent); }

        .game-layout { display: flex; gap: 40px; margin-top: 10px; align-items: flex-start; flex-wrap: wrap; justify-content: center; }
        .grid-container { border: 4px solid var(--border); padding: 5px; background: #000; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: repeat(10, 32px); grid-template-rows: repeat(10, 32px); gap: 2px; }
        
        .cell { width: 32px; height: 32px; background: var(--bg); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: 0.2s; }
        .cell.preview { background: rgba(59, 130, 246, 0.4); }
        .cell.ship { background: var(--player); border: 1px solid rgba(255,255,255,0.1); }
        .cell.hit { background: var(--enemy); box-shadow: inset 0 0 10px black; animation: splash 0.3s ease; }
        .cell.hit::after { content: "ðŸ’¥"; font-size: 14px; }
        .cell.miss { background: #334155; animation: splash 0.5s ease; }
        .cell.miss::after { content: "â€¢"; color: #94a3b8; }

        @keyframes splash { 0% { transform: scale(0.5); opacity: 0; } 50% { transform: scale(1.2); } 100% { transform: scale(1); opacity: 1; } }
        .shake { animation: shakeEffect 0.4s; }
        @keyframes shakeEffect {
            0%, 100% { transform: translate(0,0); }
            20% { transform: translate(-5px, 0); }
            40% { transform: translate(5px, 0); }
            60% { transform: translate(-5px, 0); }
            80% { transform: translate(5px, 0); }
        }

        .status-area { display: flex; gap: 40px; margin: 30px 0; flex-wrap: wrap; justify-content: center; }
        .ship-box { background: var(--panel); border: 2px solid var(--border); padding: 20px; border-radius: 12px; min-width: 180px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .status-indicator { padding: 8px; margin: 5px 0; background: #334155; border-radius: 6px; font-size: 13px; font-weight: 600; }
        .status-indicator.sunk { background: var(--enemy); text-decoration: line-through; color: #fff; }

        .controls { width: 220px; background: var(--panel); padding: 20px; border-radius: 12px; border: 1px solid var(--border); }
        .ship-btn { width: 100%; padding: 12px; margin: 6px 0; cursor: pointer; background: #475569; color: white; border: none; border-radius: 6px; font-weight: bold; }
        #start-btn { width: 100%; padding: 18px; background: var(--accent); color: white; font-weight: bold; border: none; margin-top: 15px; display: none; cursor: pointer; border-radius: 8px; font-size: 1.1rem; }

        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; justify-content: center; align-items: center; }
        .modal-content { background: var(--panel); padding: 50px; border-radius: 20px; border: 4px solid var(--accent); text-align: center; max-width: 500px; box-shadow: 0 0 50px var(--accent); }
        .modal-content h2 { font-size: 4rem; color: var(--accent); margin: 0 0 20px 0; }
        
        @media (max-width: 768px) {
            .main-title { font-size: 3rem; letter-spacing: 6px; }
            .grid { grid-template-columns: repeat(10, 28px); grid-template-rows: repeat(10, 28px); }
            .cell { width: 28px; height: 28px; }
        }
    </style>
</head>
<body id="game-body">

    <h1 class="main-title">Battleships</h1>

    <div class="top-bar">
        <button class="help-btn" onclick="toggleHelp(true)">HOW TO PLAY</button>
        <div class="stats-bar">TURNS: <span id="turn-count">0</span></div>
        <button class="audio-ctrl" id="mute-btn" onclick="toggleMusic()">ðŸŽµ MUSIC: OFF</button>
    </div>

    <h2 id="status-text" style="color: #94a3b8;">Deploy Your Fleet</h2>

    <div class="game-layout">
        <div class="controls" id="sidebar">
            <div id="ship-buttons">
                <button class="ship-btn" id="btn-5" onclick="pickShip(5, 'btn-5', 'Carrier')">Carrier (5)</button>
                <button class="ship-btn" id="btn-4" onclick="pickShip(4, 'btn-4', 'Battleship')">Battleship (4)</button>
                <button class="ship-btn" id="btn-3a" onclick="pickShip(3, 'btn-3a', 'Submarine')">Submarine (3)</button>
                <button class="ship-btn" id="btn-3b" onclick="pickShip(3, 'btn-3b', 'Destroyer')">Destroyer (3)</button>
                <button class="ship-btn" id="btn-2" onclick="pickShip(2, 'btn-2', 'Patrol Boat')">Patrol Boat (2)</button>
            </div>
            <button class="ship-btn" style="background: var(--player)" onclick="rotate()">ROTATE SHIP</button>
            <button id="start-btn" onclick="lockIn()">LOCK IN & START</button>
        </div>

        <div class="grid-container"><div id="player-grid" class="grid"></div></div>
        <div id="enemy-section" style="opacity: 0.1; pointer-events: none;">
            <div class="grid-container"><div id="enemy-grid" class="grid"></div></div>
        </div>
    </div>

    <div class="status-area">
        <div class="ship-box"><h4>MY FLEET</h4><div id="p-track-Carrier" class="status-indicator">Carrier [5]</div><div id="p-track-Battleship" class="status-indicator">Battleship [4]</div><div id="p-track-Submarine" class="status-indicator">Submarine [3]</div><div id="p-track-Destroyer" class="status-indicator">Destroyer [3]</div><div id="p-track-Patrol" class="status-indicator">Patrol Boat [2]</div></div>
        <div class="ship-box"><h4>ENEMY FLEET</h4><div id="e-track-Carrier" class="status-indicator">Carrier [5]</div><div id="e-track-Battleship" class="status-indicator">Battleship [4]</div><div id="e-track-Submarine" class="status-indicator">Submarine [3]</div><div id="e-track-Destroyer" class="status-indicator">Destroyer [3]</div><div id="e-track-Patrol" class="status-indicator">Patrol Boat [2]</div></div>
    </div>

    <div id="help-modal" class="overlay" onclick="toggleHelp(false)"><div class="modal-content" style="text-align:left;"><h3>Mission Briefing</h3><ol><li>Select a ship and place it on your grid.</li><li>Toggle 'Rotate' for vertical placement.</li><li>Once 5 ships are deployed, click 'Lock In'.</li><li>Fire at Enemy Waters. AI will hunt you if it scores a hit!</li></ol></div></div>
    
    <div id="win-modal" class="overlay"><div class="modal-content"><h2 id="winner-msg">YOU WIN!</h2><p id="final-stats" style="font-size: 1.2rem; margin-bottom: 20px;"></p><button onclick="location.reload()" style="background: var(--accent); color:white; padding: 15px 30px; border:none; border-radius:8px; cursor:pointer; font-weight:bold;">REDEPLOY FLEET</button></div></div>

    <audio id="bg-music" loop src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3"></audio>

<script>
    const pGrid = document.getElementById('player-grid'), eGrid = document.getElementById('enemy-grid'), statusText = document.getElementById('status-text'), startBtn = document.getElementById('start-btn'), music = document.getElementById('bg-music'), turnDisp = document.getElementById('turn-count');
    let horizontal = true, currentSize = 0, currentBtnId = null, currentShipName = '', placedCount = 0, isTurn = false, musicOn = false, turns = 0;
    let pShips = {}, eShips = {}, pShipCoords = [], eShipCoords = [];

    // AI Hunting State
    let aiHuntMode = false, aiTargets = [];

    function init() {
        for(let i=0; i<100; i++){
            let pCell = document.createElement('div'); pCell.className = 'cell';
            pCell.onmouseover = () => { if(currentSize) showPreview(i); };
            pCell.onmouseleave = clearPreview; pCell.onclick = () => placeShip(i);
            pGrid.appendChild(pCell);
            let eCell = document.createElement('div'); eCell.className = 'cell';
            eCell.onclick = () => playerAttack(i); eGrid.appendChild(eCell);
        }
    }

    function toggleMusic() { musicOn = !musicOn; musicOn ? music.play() : music.pause(); document.getElementById('mute-btn').innerText = musicOn ? "ðŸŽµ MUSIC: ON" : "ðŸŽµ MUSIC: OFF"; }
    function toggleHelp(s) { document.getElementById('help-modal').style.display = s ? 'flex' : 'none'; }
    function rotate() { horizontal = !horizontal; }
    function pickShip(s, id, n) { currentSize = s; currentBtnId = id; currentShipName = n; }
    function clearPreview() { Array.from(pGrid.children).forEach(c => c.classList.remove('preview')); }

    function showPreview(idx) {
        clearPreview();
        const path = getPath(idx, currentSize);
        if(path) path.forEach(i => pGrid.children[i].classList.add('preview'));
    }

    function getPath(idx, size) {
        let path = [];
        for(let i=0; i<size; i++){
            let n = horizontal ? idx + i : idx + (i*10);
            if(n > 99 || (horizontal && Math.floor(n/10) !== Math.floor(idx/10))) return null;
            path.push(n);
        }
        return path;
    }

    function placeShip(idx) {
        if(!currentSize) return;
        const path = getPath(idx, currentSize);
        if(!path || path.some(p => pShipCoords.includes(p))) return;
        let key = currentShipName.split(' ')[0];
        pShips[key] = path; pShipCoords.push(...path);
        path.forEach(i => pGrid.children[i].classList.add('ship'));
        document.getElementById(currentBtnId).style.display = 'none';
        currentSize = 0; placedCount++;
        if(placedCount === 5) startBtn.style.display = 'block';
    }

    function lockIn() {
        document.getElementById('sidebar').style.display = 'none';
        document.getElementById('enemy-section').style.opacity = '1';
        document.getElementById('enemy-section').style.pointerEvents = 'auto';
        generateEnemy(); isTurn = true; statusText.innerText = "COMMANDER, TAKE YOUR SHOT.";
    }

    function generateEnemy() {
        const d = [{n:'Carrier', s:5}, {n:'Battleship', s:4}, {n:'Submarine', s:3}, {n:'Destroyer', s:3}, {n:'Patrol', s:2}];
        d.forEach(sh => {
            let placed = false;
            while(!placed) {
                let h = Math.random() > 0.5, start = Math.floor(Math.random()*100), path = [];
                for(let i=0; i<sh.s; i++){
                    let n = h ? start + i : start + (i*10);
                    if(n < 100 && (!h || Math.floor(n/10) === Math.floor(start/10)) && !eShipCoords.includes(n)) path.push(n);
                }
                if(path.length === sh.s) { eShips[sh.n] = path; eShipCoords.push(...path); placed = true; }
            }
        });
    }

    function playerAttack(i) {
        if(!isTurn || eGrid.children[i].classList.contains('hit') || eGrid.children[i].classList.contains('miss')) return;
        turns++; turnDisp.innerText = turns;
        let hit = false;
        for(let n in eShips) {
            if(eShips[n].includes(i)) {
                eGrid.children[i].classList.add('hit');
                eShips[n] = eShips[n].filter(c => c !== i);
                if(eShips[n].length === 0) { document.getElementById(`e-track-${n}`).classList.add('sunk'); triggerShake(); }
                hit = true; break;
            }
        }
        if(!hit) eGrid.children[i].classList.add('miss');
        if(Object.values(eShips).flat().length === 0) return end("VICTORY!");
        isTurn = false; statusText.innerText = "ENEMY IS FIRING...";
        setTimeout(aiMove, 800);
    }

    function aiMove() {
        let r;
        if(aiHuntMode && aiTargets.length > 0) {
            r = aiTargets.shift();
        } else {
            do { r = Math.floor(Math.random()*100); } while(pGrid.children[r].classList.contains('hit') || pGrid.children[r].classList.contains('miss'));
        }

        let hit = false;
        for(let n in pShips) {
            if(pShips[n].includes(r)) {
                pGrid.children[r].classList.add('hit');
                pShips[n] = pShips[n].filter(c => c !== r);
                if(pShips[n].length === 0) { 
                    document.getElementById(`p-track-${n}`).classList.add('sunk'); 
                    triggerShake(); aiHuntMode = false; aiTargets = [];
                } else {
                    aiHuntMode = true;
                    [r-10, r+10, r-1, r+1].forEach(t => {
                        if(t >= 0 && t < 100 && !pGrid.children[t].classList.contains('hit') && !pGrid.children[t].classList.contains('miss') && !aiTargets.includes(t)) aiTargets.push(t);
                    });
                }
                hit = true; break;
            }
        }
        if(!hit) pGrid.children[r].classList.add('miss');
        if(Object.values(pShips).flat().length === 0) return end("DEFEAT!");
        isTurn = true; statusText.innerText = "YOUR TURN, COMMANDER.";
    }

    function triggerShake() {
        document.getElementById('game-body').classList.add('shake');
        setTimeout(() => document.getElementById('game-body').classList.remove('shake'), 400);
    }

    function end(m) {
        document.getElementById('winner-msg').innerText = m;
        document.getElementById('final-stats').innerText = `MISSION COMPLETE IN ${turns} TURNS.`;
        document.getElementById('win-modal').style.display = 'flex';
    }

    init();
</script>
</body>
</html>
